window.inmap_maps=[];window.inmap_create_map=function(e=null,a=null,t=null){if(!e||!a||!jQuery||typeof inmap_L!="object")return!1;var f={attributionControl:!1},u="inmap-"+e,n=jQuery("#"+u);if(!n.length)return!1;var m=inmap_L.map(u,f),d=inmap_L.control.attribution({prefix:!1});d.addAttribution('<a href="https://github.com/OpenGIS/inreach-mapshare">Inreach Mapshare</a>'),d.addTo(m),n.data("map_l",m),inmap_maps[e]=m;var c=jQuery("body").first(),r=n.parents(".inmap-wrap",c),y=jQuery(".inmap-info",r),h={},_={},s={},b={},w={},C={},N=function(){var o=y.height(),l=b.height(),p=o-l;p>0?y.css("padding-top",l+"px"):y.removeAttr("style")},z=function(){D(),F(),jQuery(window).on("resize",function(){Q()}),Q()},Q=function(){r.hasClass("inmap-fullscreen")?r.css({width:c.width()+"px",height:c.height()+"px",zIndex:9999999999999}):r.removeAttr("style"),N(),typeof w.get=="function"&&w.get(0).scrollIntoView({behaviour:"smooth",block:"center"}),m.invalidateSize()},F=function(){C=jQuery(".leaflet-control-container .leaflet-top",n).first();var o=jQuery("<div />").attr({class:"inmap-control leaflet-bar leaflet-control"}).append(jQuery("<a />").attr({class:"inmap-button inmap-icon inmap-icon-fullscreen",href:"#",title:"Fullscreen",role:"button","aria-label":"Fullscreen"}).on("click",function(p){p.preventDefault(),c.toggleClass("inmap-has-single"),r.toggleClass("inmap-fullscreen"),Q()}));C.addClass("inmap-map-ui").append(o);var l=jQuery("<div />").attr({class:"inmap-control leaflet-bar leaflet-control"}).append(jQuery("<a />").attr({class:"inmap-button inmap-icon inmap-icon-detail",href:"#",title:"Details",role:"button","aria-label":"Details"}).on("click",function(p){p.preventDefault(),r.toggleClass("inmap-info-hidden"),Q()}));C.append(l)},D=function(){for(id in s){var o=jQuery(".inmap-info-title",s[id]),l=o.text().replace("[","<span>").replace("]","</span>");o.html(l),s[id].hasClass("inmap-only")||s[id].addClass("inmap-hide-extended");var p=jQuery(".inmap-icon",_[id]);s[id].append(p.clone()),jQuery("table tr",s[id]).each(function(){var v=jQuery(this),k=jQuery("td",v);jQuery("th",v).addClass("inmap-info-extended");var I=v.attr("class").replace("inmap-assoc_array-",""),q=k.text();switch(I){case"elevation":var L=parseFloat(q);isNaN(L)||k.text(L.toFixed(1)+" (m) "+(L*3.28084).toFixed(1)+" (ft) ");break;case"velocity":var S=parseFloat(q);isNaN(S)||k.text(S.toFixed(1)+" (km/h) "+(S*1.609344).toFixed(1)+" (mph) ");break;case"time_utc":case"valid_gps_fix":v.addClass("inmap-info-extended");break}}),s[id].hasClass("inmap-last")&&(b=s[id])}inmap_shortcode_js.detail_expanded==="false"&&r.addClass("inmap-info-hidden")},g=function(o=null,l="active",p=!1){var v=14;for(this_id in h)this_id===o?(l=="active"&&s[this_id].hasClass("inmap-active")?(s[this_id].removeClass("inmap-hide-extended"),m.getZoom()<v?m.setView(h[this_id].getLatLng(),v):m.setView(h[this_id].getLatLng())):(_[this_id].addClass("inmap-"+l),s[this_id].addClass("inmap-"+l)),l=="active"&&(r.removeClass("inmap-info-hidden"),p&&s[this_id].get(0).scrollIntoView({behaviour:"smooth",block:"center"}),m.setView(h[this_id].getLatLng()))):l=="active"?(s[this_id].removeClass("inmap-active"),s[this_id].hasClass("inmap-last")||_[this_id].removeClass("inmap-active")):(s[this_id].removeClass("inmap-"+l),_[this_id].removeClass("inmap-"+l));l=="active"&&N(),Q()},E=function(o){inmap_L.geoJSON(o,{style:{color:"#ff7800",weight:3,opacity:.5},onEachFeature:function(l,p){p.bindTooltip("Planned Route")}}).addTo(m)},T="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png";if(typeof inmap_shortcode_js.basemap_url=="string"&&inmap_shortcode_js.basemap_url.length)var T=inmap_shortcode_js.basemap_url;var O='&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>';if(typeof inmap_shortcode_js.basemap_attribution=="string"&&inmap_shortcode_js.basemap_attribution.length)var O=inmap_shortcode_js.basemap_attribution;inmap_L.tileLayer(T,{maxZoom:19,attribution:O}).addTo(m);var x=inmap_L.geoJSON(a,{style:function(o){if(typeof o.properties.style=="object")return o.properties.style},pointToLayer:function(o,l){if(typeof o.properties.id>"u")return!1;var p=o.properties.id.toString();return typeof o.properties.icon=="object"?h[p]=inmap_L.marker(l,{icon:inmap_L.divIcon(o.properties.icon)}):h[p]=inmap_L.marker(l),s[p]=jQuery("<div />").addClass(o.properties.className).attr("title",o.properties.title).html(o.properties.description).hover(function(){g(p,"hover")},function(){g(null,"hover")}).on("click",function(){w=jQuery(this),g(p,"active")}),y.append(s[p]),h[p]},onEachFeature:function(o,l){if(typeof o.properties.id>"u")return!1;var p=o.properties.id.toString();l.on("add",function(v){_[p]=jQuery(v.target.getElement()).attr("title",o.properties.title).addClass(o.properties.className).data("marker_l",v.target).on("mouseenter",function(){g(p,"hover",!0)}).on("click",function(){g(p,"active",!0)})})}});x.addTo(m),x.on("add",function(){z()}),m.fitBounds(x.getBounds()),t&&JSON.stringify(t)&&E(t)};window.inmap_setup_parameter_tooltips=function(){jQuery("a.inmap-tooltip").on({mouseenter:function(e){var a=jQuery(this).data("title");jQuery('<p id="inmap-tooltip-active"></p>').text(a).appendTo("body").fadeIn("slow")},mouseleave:function(e){jQuery("#inmap-tooltip-active").remove()},mousemove:function(e){if(inmap_is_touch_device())var a=e.pageX-250;else var a=e.pageX-220;var t=e.pageY+5;jQuery("#inmap-tooltip-active").css({top:t,left:a})}})};window.inmap_is_touch_device=function(){var e=" -webkit- -moz- -o- -ms- ".split(" "),a=function(f){return window.matchMedia(f).matches};if("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)return!0;var t=["(",e.join("touch-enabled),("),"heartz",")"].join("");return a(t)};window.inmap_setup_accordions=function(){var e=jQuery(".inmap-accordion-container");e.length&&(e.addClass("inmap-self-clear"),e.each(function(){var a=0;jQuery(".inmap-accordion-group",jQuery(this)).each(function(){var t=jQuery(this);t.addClass("inmap-self-clear"),t.data("inmap-index",a);var f=jQuery(".inmap-accordion-group-content",t);a==0?(t.addClass("inmap-first inmap-active"),f.show().addClass(a)):f.hide().addClass(a),jQuery("legend",jQuery(this)).each(function(){var u=jQuery(this).html();if(u.indexOf("[+]")==-1&&u.indexOf("[-]")==-1){var n=a==0?"[-]":"[+]";jQuery(this).html(u+" <span>"+n+"</span>")}jQuery(this).click(function(){var m=jQuery(this).parents(".inmap-accordion-group").data("inmap-index");jQuery(".inmap-accordion-group",jQuery(this).parents(".inmap-accordion-container")).each(function(){if(jQuery(this).data("inmap-index")==m){var d=jQuery("legend",jQuery(this));jQuery(this).hasClass("inmap-active")?(d.html(d.html().replace("[-]","[+]")),jQuery(this).removeClass("inmap-active"),jQuery(".inmap-accordion-group-content",jQuery(this)).slideUp()):(d.html(d.html().replace("[+]","[-]")),jQuery(this).addClass("inmap-active"),jQuery(".inmap-accordion-group-content",jQuery(this)).slideDown())}else{jQuery(this).removeClass("inmap-active");var d=jQuery("legend",jQuery(this));d.html(d.html().replace("[-]","[+]")),jQuery(".inmap-accordion-group-content",jQuery(this)).slideUp()}})})}),a++})}))};window.inmap_setup_repeatable_settings=function(){jQuery(".inmap-settings-tab .inmap-repeatable").each(function(){var e=jQuery(this);jQuery(".form-table",e).each(function(){var a=jQuery(this),t=[];for(a.remove(),jQuery(".inmap-input",a).each(function(){var c=jQuery(this);if(c.addClass("inmap-"+c.data("id")),c.get(0).nodeName!="SELECT")var r=c.val();else var r=c.data("multi-value");typeof r!="string"&&(r=r.toString()),r=r.split(inmap_admin_js.multi_value_seperator);for(i in r)typeof t[i]!="object"&&(t[i]={}),t[i][c.data("id")]=r[i]}),i=0;i<t.length;i++){var f=a.clone();for(j in t[i]){var u=t[i][j],n=jQuery(".inmap-input-"+j,f);n.attr("name",n.attr("name")+"["+i+"]"),n.get(0).nodeName=="SELECT"&&!jQuery("option[value='"+t[i][j]+"']",n).length&&(u=jQuery("option",n).first().val()),n.attr("value",u).val(u),n.parents(".inmap-control-group").hasClass("inmap-uneditable")&&n.attr("readonly","readonly")}var m=jQuery("<div />").text("x").attr("title",inmap_admin_js.lang.repeatable_delete_title).addClass("inmap-delete").on("click",function(c){c.preventDefault();var r=jQuery(this).parents(".form-table");return r.remove(),!1});f.append(m),e.append(f),e.attr("data-count",i),inmap_setup_parameter_tooltips()}var d=jQuery("<button />").html('<i class="ion ion-plus"></i>').addClass("button inmap-add").on("click",function(c){c.preventDefault();var r=jQuery(this).parents(".inmap-repeatable"),y=parseInt(r.attr("data-count")),h=y+1;r.attr("data-count",h);var _=a.clone();return jQuery(".inmap-input",_).each(function(){var s=jQuery(this),b=s.attr("name")+"["+h+"]";s.attr("name",b),s.attr("placeholder",""),s.get(0).nodeName!="SELECT"&&s.val("")}),jQuery(this).before(_),inmap_setup_parameter_tooltips(),inmap_setup_colour_pickers(),!1});e.append(d),e.sortable()})})};window.inmap_setup_dropdowns=function(){jQuery(".inmap-parameters-container").each(function(){var e=jQuery(this);jQuery("select",e).each(function(){var a="inmap-dropdown-"+jQuery(this).data("id")+"-";a+=jQuery(this).val(),e.addClass(a),jQuery(this).on("change",function(){var t="inmap-dropdown-"+jQuery(this).data("id")+"-";jQuery("option",jQuery(this)).each(function(){e.removeClass(t+jQuery(this).attr("value"))}),t+=jQuery(this).val(),e.addClass(t)})})})};window.inmap_setup_settings_nav=function(){var e=jQuery("body.wp-admin #inmap-settings-nav");if(!e)return!1;var a=jQuery("#inmap-admin-container"),t=jQuery("form",a);jQuery(".inmap-settings-tab",a);var f=e.data("init_tab_key"),u=jQuery("select",e);u.hover(function(){jQuery(this).attr("size",jQuery("option",jQuery(this)).length)},function(){jQuery(this).removeAttr("size")}),u.change(function(){u.removeAttr("size");var n=jQuery(this).val();a.attr("class","");var m=jQuery('input[name="_wp_http_referer"]',t),d=document.location.toString();d.indexOf("content=")>0?d=d.replace("content="+f,"content="+n):d=d+"&content="+n,m.val(d),jQuery("."+n).first(),jQuery(".inmap-settings-tab").each(function(){var c=jQuery(this);c.hide(),n.indexOf("settings-tab")&&c.hasClass(n)&&(c.show(),a.addClass("inmap-active-"+n)),jQuery(".inmap-settings-section",c).each(function(){var r=jQuery(this);n.indexOf("settings-tab")>0?r.show():n.indexOf("settings-section")>0&&(r.hide(),r.hasClass(n)&&(c.show(),r.show(),a.addClass("inmap-active-"+n)))})})}),u.trigger("change")};window.inmap_admin_message=function(e=null,a="info",t="#inmap-admin-container .card"){if(e){var f=jQuery(t).first();if(!f.length)var f=jQuery("#wpbody-content").first();if(f.length){jQuery(".notice").each(function(){jQuery(this).remove()});var u=jQuery("<div />").attr({class:"inmap-notice notice notice-"+a}),n=jQuery("<p />").html(e);u.append(n),f.prepend(u)}else alert(e)}};window.inmap_setup_colour_pickers=function(){jQuery(".inmap-colour-picker .inmap-input").wpColorPicker()};jQuery(document).ready(function(){inmap_setup_parameter_tooltips(),inmap_setup_accordions(),inmap_setup_settings_nav(),inmap_setup_repeatable_settings(),inmap_setup_dropdowns(),inmap_setup_colour_pickers()});
