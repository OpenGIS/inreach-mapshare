window.inmap_maps=[];window.inmap_create_map=function(e=null,a=null,t=null){if(!e||!a||!jQuery||typeof inmap_L!="object")return!1;var f={attributionControl:!1},m="inmap-"+e,n=jQuery("#"+m);if(!n.length)return!1;var d=inmap_L.map(m,f),u=inmap_L.control.attribution({prefix:!1});u.addAttribution('<a href="https://github.com/OpenGIS/inreach-mapshare">Inreach Mapshare</a>'),u.addTo(d),n.data("map_l",d),inmap_maps[e]=d;var c=jQuery("body").first(),o=n.parents(".inmap-wrap",c),y=jQuery(".inmap-info",o),h={},_={},s={},b={},C={},x={},w={},T=function(){var r=y.height(),l=b.height(),p=r-l;p>0?y.css("padding-top",l+"px"):y.removeAttr("style")},F=function(){E(),D(),jQuery(window).on("resize",function(){Q()}),Q()},Q=function(){o.hasClass("inmap-fullscreen")?o.css({width:c.width()+"px",height:c.height()+"px",zIndex:9999999999999}):o.removeAttr("style"),T(),typeof C.get=="function"&&C.get(0).scrollIntoView({behaviour:"smooth",block:"center"}),d.invalidateSize(),w&&w.getLatLng&&d.setView(w.getLatLng())},D=function(){x=jQuery(".leaflet-control-container .leaflet-top",n).first();var r=jQuery("<div />").attr({class:"inmap-control leaflet-bar leaflet-control"}).append(jQuery("<a />").attr({class:"inmap-button inmap-icon inmap-icon-fullscreen",href:"#",title:"Fullscreen",role:"button","aria-label":"Fullscreen"}).on("click",function(p){p.preventDefault(),c.toggleClass("inmap-has-single"),o.toggleClass("inmap-fullscreen"),Q()}));x.addClass("inmap-map-ui").append(r);var l=jQuery("<div />").attr({class:"inmap-control leaflet-bar leaflet-control"}).append(jQuery("<a />").attr({class:"inmap-button inmap-icon inmap-icon-detail",href:"#",title:"Details",role:"button","aria-label":"Details"}).on("click",function(p){p.preventDefault(),o.toggleClass("inmap-info-hidden"),Q()}));x.append(l)},E=function(){for(id in s){var r=jQuery(".inmap-info-title",s[id]),l=r.text().replace("[","<span>").replace("]","</span>");r.html(l),s[id].hasClass("inmap-only")||s[id].addClass("inmap-hide-extended");var p=jQuery(".inmap-icon",_[id]);s[id].append(p.clone()),jQuery("table tr",s[id]).each(function(){var v=jQuery(this),L=jQuery("td",v);jQuery("th",v).addClass("inmap-info-extended");var V=v.attr("class").replace("inmap-assoc_array-",""),z=L.text();switch(V){case"elevation":var S=parseFloat(z);isNaN(S)||L.text(S.toFixed(1)+" (m) "+(S*3.28084).toFixed(1)+" (ft) ");break;case"velocity":var N=parseFloat(z);isNaN(N)||L.text(N.toFixed(1)+" (km/h) "+(N*1.609344).toFixed(1)+" (mph) ");break;case"time_utc":case"valid_gps_fix":v.addClass("inmap-info-extended");break}}),s[id].hasClass("inmap-last")&&(b=s[id])}inmap_shortcode_js.detail_expanded==="false"&&o.addClass("inmap-info-hidden")},g=function(r=null,l="active",p=!1){var v=14;for(this_id in h)this_id===r?(l=="active"&&s[this_id].hasClass("inmap-active")?(s[this_id].removeClass("inmap-hide-extended"),d.getZoom()<v?d.setView(h[this_id].getLatLng(),v):d.setView(h[this_id].getLatLng())):(_[this_id].addClass("inmap-"+l),s[this_id].addClass("inmap-"+l)),l=="active"&&(o.removeClass("inmap-info-hidden"),p&&s[this_id].get(0).scrollIntoView({behaviour:"smooth",block:"center"}),d.setView(h[this_id].getLatLng()))):l=="active"?(s[this_id].removeClass("inmap-active"),s[this_id].hasClass("inmap-last")||_[this_id].removeClass("inmap-active")):(s[this_id].removeClass("inmap-"+l),_[this_id].removeClass("inmap-"+l));l=="active"&&(r&&(w=h[r]),T()),Q()},I=function(r){inmap_L.geoJSON(r,{style:{color:"#ff7800",weight:3,opacity:.5},onEachFeature:function(l,p){p.bindTooltip("Planned Route")}}).addTo(d)},O="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png";if(typeof inmap_shortcode_js.basemap_url=="string"&&inmap_shortcode_js.basemap_url.length)var O=inmap_shortcode_js.basemap_url;var q='&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>';if(typeof inmap_shortcode_js.basemap_attribution=="string"&&inmap_shortcode_js.basemap_attribution.length)var q=inmap_shortcode_js.basemap_attribution;inmap_L.tileLayer(O,{maxZoom:19,attribution:q}).addTo(d);var k=inmap_L.geoJSON(a,{style:function(r){if(typeof r.properties.style=="object")return r.properties.style},pointToLayer:function(r,l){if(typeof r.properties.id>"u")return!1;var p=r.properties.id.toString();return typeof r.properties.icon=="object"?h[p]=inmap_L.marker(l,{icon:inmap_L.divIcon(r.properties.icon)}):h[p]=inmap_L.marker(l),s[p]=jQuery("<div />").addClass(r.properties.className).attr("title",r.properties.title).html(r.properties.description).hover(function(){g(p,"hover")},function(){g(null,"hover")}).on("click",function(){C=jQuery(this),g(p,"active")}),y.append(s[p]),h[p]},onEachFeature:function(r,l){if(typeof r.properties.id>"u")return!1;var p=r.properties.id.toString();l.on("add",function(v){_[p]=jQuery(v.target.getElement()).attr("title",r.properties.title).addClass(r.properties.className).data("marker_l",v.target).on("mouseenter",function(){g(p,"hover",!0)}).on("click",function(){g(p,"active",!0)})})}});k.addTo(d),k.on("add",function(){F()}),d.fitBounds(k.getBounds()),t&&JSON.stringify(t)&&I(t)};window.inmap_setup_parameter_tooltips=function(){jQuery("a.inmap-tooltip").on({mouseenter:function(e){var a=jQuery(this).data("title");jQuery('<p id="inmap-tooltip-active"></p>').text(a).appendTo("body").fadeIn("slow")},mouseleave:function(e){jQuery("#inmap-tooltip-active").remove()},mousemove:function(e){if(inmap_is_touch_device())var a=e.pageX-250;else var a=e.pageX-220;var t=e.pageY+5;jQuery("#inmap-tooltip-active").css({top:t,left:a})}})};window.inmap_is_touch_device=function(){var e=" -webkit- -moz- -o- -ms- ".split(" "),a=function(f){return window.matchMedia(f).matches};if("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)return!0;var t=["(",e.join("touch-enabled),("),"heartz",")"].join("");return a(t)};window.inmap_setup_accordions=function(){var e=jQuery(".inmap-accordion-container");e.length&&(e.addClass("inmap-self-clear"),e.each(function(){var a=0;jQuery(".inmap-accordion-group",jQuery(this)).each(function(){var t=jQuery(this);t.addClass("inmap-self-clear"),t.data("inmap-index",a);var f=jQuery(".inmap-accordion-group-content",t);a==0?(t.addClass("inmap-first inmap-active"),f.show().addClass(a)):f.hide().addClass(a),jQuery("legend",jQuery(this)).each(function(){var m=jQuery(this).html();if(m.indexOf("[+]")==-1&&m.indexOf("[-]")==-1){var n=a==0?"[-]":"[+]";jQuery(this).html(m+" <span>"+n+"</span>")}jQuery(this).click(function(){var d=jQuery(this).parents(".inmap-accordion-group").data("inmap-index");jQuery(".inmap-accordion-group",jQuery(this).parents(".inmap-accordion-container")).each(function(){if(jQuery(this).data("inmap-index")==d){var u=jQuery("legend",jQuery(this));jQuery(this).hasClass("inmap-active")?(u.html(u.html().replace("[-]","[+]")),jQuery(this).removeClass("inmap-active"),jQuery(".inmap-accordion-group-content",jQuery(this)).slideUp()):(u.html(u.html().replace("[+]","[-]")),jQuery(this).addClass("inmap-active"),jQuery(".inmap-accordion-group-content",jQuery(this)).slideDown())}else{jQuery(this).removeClass("inmap-active");var u=jQuery("legend",jQuery(this));u.html(u.html().replace("[-]","[+]")),jQuery(".inmap-accordion-group-content",jQuery(this)).slideUp()}})})}),a++})}))};window.inmap_setup_repeatable_settings=function(){jQuery(".inmap-settings-tab .inmap-repeatable").each(function(){var e=jQuery(this);jQuery(".form-table",e).each(function(){var a=jQuery(this),t=[];for(a.remove(),jQuery(".inmap-input",a).each(function(){var c=jQuery(this);if(c.addClass("inmap-"+c.data("id")),c.get(0).nodeName!="SELECT")var o=c.val();else var o=c.data("multi-value");typeof o!="string"&&(o=o.toString()),o=o.split(inmap_admin_js.multi_value_seperator);for(i in o)typeof t[i]!="object"&&(t[i]={}),t[i][c.data("id")]=o[i]}),i=0;i<t.length;i++){var f=a.clone();for(j in t[i]){var m=t[i][j],n=jQuery(".inmap-input-"+j,f);n.attr("name",n.attr("name")+"["+i+"]"),n.get(0).nodeName=="SELECT"&&!jQuery("option[value='"+t[i][j]+"']",n).length&&(m=jQuery("option",n).first().val()),n.attr("value",m).val(m),n.parents(".inmap-control-group").hasClass("inmap-uneditable")&&n.attr("readonly","readonly")}var d=jQuery("<div />").text("x").attr("title",inmap_admin_js.lang.repeatable_delete_title).addClass("inmap-delete").on("click",function(c){c.preventDefault();var o=jQuery(this).parents(".form-table");return o.remove(),!1});f.append(d),e.append(f),e.attr("data-count",i),inmap_setup_parameter_tooltips()}var u=jQuery("<button />").html('<i class="ion ion-plus"></i>').addClass("button inmap-add").on("click",function(c){c.preventDefault();var o=jQuery(this).parents(".inmap-repeatable"),y=parseInt(o.attr("data-count")),h=y+1;o.attr("data-count",h);var _=a.clone();return jQuery(".inmap-input",_).each(function(){var s=jQuery(this),b=s.attr("name")+"["+h+"]";s.attr("name",b),s.attr("placeholder",""),s.get(0).nodeName!="SELECT"&&s.val("")}),jQuery(this).before(_),inmap_setup_parameter_tooltips(),inmap_setup_colour_pickers(),!1});e.append(u),e.sortable()})})};window.inmap_setup_dropdowns=function(){jQuery(".inmap-parameters-container").each(function(){var e=jQuery(this);jQuery("select",e).each(function(){var a="inmap-dropdown-"+jQuery(this).data("id")+"-";a+=jQuery(this).val(),e.addClass(a),jQuery(this).on("change",function(){var t="inmap-dropdown-"+jQuery(this).data("id")+"-";jQuery("option",jQuery(this)).each(function(){e.removeClass(t+jQuery(this).attr("value"))}),t+=jQuery(this).val(),e.addClass(t)})})})};window.inmap_setup_settings_nav=function(){var e=jQuery("body.wp-admin #inmap-settings-nav");if(!e)return!1;var a=jQuery("#inmap-admin-container"),t=jQuery("form",a);jQuery(".inmap-settings-tab",a);var f=e.data("init_tab_key"),m=jQuery("select",e);m.hover(function(){jQuery(this).attr("size",jQuery("option",jQuery(this)).length)},function(){jQuery(this).removeAttr("size")}),m.change(function(){m.removeAttr("size");var n=jQuery(this).val();a.attr("class","");var d=jQuery('input[name="_wp_http_referer"]',t),u=document.location.toString();u.indexOf("content=")>0?u=u.replace("content="+f,"content="+n):u=u+"&content="+n,d.val(u),jQuery("."+n).first(),jQuery(".inmap-settings-tab").each(function(){var c=jQuery(this);c.hide(),n.indexOf("settings-tab")&&c.hasClass(n)&&(c.show(),a.addClass("inmap-active-"+n)),jQuery(".inmap-settings-section",c).each(function(){var o=jQuery(this);n.indexOf("settings-tab")>0?o.show():n.indexOf("settings-section")>0&&(o.hide(),o.hasClass(n)&&(c.show(),o.show(),a.addClass("inmap-active-"+n)))})})}),m.trigger("change")};window.inmap_admin_message=function(e=null,a="info",t="#inmap-admin-container .card"){if(e){var f=jQuery(t).first();if(!f.length)var f=jQuery("#wpbody-content").first();if(f.length){jQuery(".notice").each(function(){jQuery(this).remove()});var m=jQuery("<div />").attr({class:"inmap-notice notice notice-"+a}),n=jQuery("<p />").html(e);m.append(n),f.prepend(m)}else alert(e)}};window.inmap_setup_colour_pickers=function(){jQuery(".inmap-colour-picker .inmap-input").wpColorPicker()};jQuery(document).ready(function(){inmap_setup_parameter_tooltips(),inmap_setup_accordions(),inmap_setup_settings_nav(),inmap_setup_repeatable_settings(),inmap_setup_dropdowns(),inmap_setup_colour_pickers()});
